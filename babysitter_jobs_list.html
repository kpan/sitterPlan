<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SitterPlan</title>

<!-- Load style sheets -->
<link href='http://fonts.googleapis.com/css?family=Bubblegum+Sans|Noto+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="sitterPlan.css" />


</head>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<script type="text/javascript" src="schedule_table.js"></script>
<script>
	
	var earliestTimeOnSchedule = 13;
	var latestTimeOnSchedule = 24;
	var currentColor = "green";
	var painting = false;
	
	var dialog;
	var earliestDateOnSchedule = new Date();

	var parentScheduleTable = new ScheduleTable(24, 7);
	
	parentScheduleTable.addEventListener('paint',function (e) {
		if (e.details.newColor == "green") {
			$( "#" + e.details.day + "_" + e.details.hour + "_square").attr('class', 'greenScheduleTableSquare');
		} else if (e.details.newColor == "blank") {
			$( "#" + e.details.day + "_" + e.details.hour + "_square").attr('class', 'blankScheduleTableSquare');
		}
    },true);
	
	$(function() {
		$( "#startTime").text(as12HourTime(earliestTimeOnSchedule));
		$( "#endTime").text(as12HourTime(latestTimeOnSchedule));
		for (var i = earliestTimeOnSchedule; i < latestTimeOnSchedule; i ++){
			$("#parentScheduleTable > tbody > tr:last").after(genRow(i));
		}
		
		for (var i = 0; i < 7; i++) {
			var tempDate = new Date();
			tempDate.setDate(earliestDateOnSchedule.getDate() + i);
			var dateString = tempDate.toDateString();
			dateString = dateString.substring(0, dateString.length - 4);
			$("#day" + i).text(dateString);
		}
		
		$( "#createJob").addClass("h2");
		$( "#manageContacts").addClass("h2");
		
		makeSlider();
  	});
	
	function makeSlider() {
		$( "#timerange-slider" ).slider({range: true, min: 0, max:24,
									 orientation:"vertical",
									 values:[ 24 - latestTimeOnSchedule,
									 		  24 - earliestTimeOnSchedule ],
									 slide: function( event, ui ) {
										 		updateTimerange( 24 - ui.values[1],
												           24 - ui.values[0]);
									 }}).height("300px");
		$( "#timerange-slider > a:first").text(asShort12HourTime(latestTimeOnSchedule)).addClass("sliderLabel");
		$( "#timerange-slider > a:last").text(asShort12HourTime(earliestTimeOnSchedule)).addClass("sliderLabel");
	}
	
	document.onmousedown = function() {
		painting = true;
	}
	
	document.onmouseup = function() {
		painting = false;
	}
	
	function paintIfClicking(event, day, time) {
		if (painting) {
			parentScheduleTable.paint(day, time, currentColor);
		}
	}

	function genRow(time) {
		var row = "<tr class='scheduleTableRow' id='" + as12HourTime(time) + "row" + 
				  "'>\n<td class='scheduleRowLabel'>";
		row += as12HourTime(time) + "</td>\n";
		for (var day = 0; day < parentScheduleTable.width; day ++) {
			row += "<td class='";
			row += parentScheduleTable.getColor(day,time) + "ScheduleTableSquare";
			row += "' id='" + day + "_" + time + "_square' ";
			row += "onmousedown='parentScheduleTable.paint(" + day + "," + time + ", currentColor)' ";
			row += "onmouseover='paintIfClicking(event," + day + "," + time + ")'/>\n";
		}
		row += "</tr>\n"
		return row;
	}
		
	function updateTimerange(startTime, endTime){
		$( "#startTime").text(as12HourTime(startTime));
		$( "#endTime").text(as12HourTime(endTime));
		
		$( "#timerange-slider > a:first").text(asShort12HourTime(endTime));
		$( "#timerange-slider > a:last").text(asShort12HourTime(startTime));
		
		for (var i = earliestTimeOnSchedule; i < startTime; i++) {
			$("#" + as12HourTime(i) + "row").remove();
		}
		
		for (var i = startTime; i < endTime; i ++){
			if (i < earliestTimeOnSchedule || i >= latestTimeOnSchedule) {
				$("#parentScheduleTable > tbody > tr").eq(i - startTime).after(genRow(i));
			}
		}
		for (var i = endTime; i < latestTimeOnSchedule; i++) {
			$("#" + as12HourTime(i) + "row").remove();
		}
		earliestTimeOnSchedule = startTime;
		latestTimeOnSchedule = endTime;
	}
	
	function as12HourTime(number) {
		if (number == 0 || number == 24) {
			return "midnight";
		}
		if (number < 12) {
			return number + "am";
		}
		if (number == 12) {
			return "noon";
		} else {
			return (number - 12) + "pm";
		}
	}	

	function asShort12HourTime(number) {
		if (number == 0) {
			return 12;
		}
		if (number <= 12) {
			return number;
		}
		return number - 12;
	}	
	
	function submitJob() {
		$("#jobTable > tbody > tr:last").after("<tr><td><a href = 'javascript:none;'>" + $("#jobTitle").val() +
				"</a></td><td>" + getJobTimes() + "</td><td>No applicants yet</td></tr>");
		parentScheduleTable.clear();
		$("#jobTitle").val("");
		$("#jobDetails").val("");
		$("#hidingDiv").append($("#createJobPopup > #createJobPageTwo").remove());
		$("#createJobPopup").dialog('close');
	}
	
	function getJobTimes() {
		var time = "";
		if ('checked' == $("#flexibleButton").attr('checked')) {
			time += $("#jobLength").val() + " hours within ";
		}
		var outputstrings = [];
		var timeblocks = parentScheduleTable.getTimeblocks();
		for (var i = 0; i < timeblocks.length; i++) {
			var block = timeblocks[i];
			outputstrings.push($("#day" + block.start.day).text() + " " + as12HourTime(block.start.hour) 
									 + " to " + as12HourTime(block.end.hour));
		}
		return time + outputstrings.join(" or ");
	}
	
	function toggleFlexVisibility(){
		$("#flexibleSchedule").toggleClass('invisible');
	}
	
	function nextDialog() {
		$("#hidingDiv").append($("#createJobPopup > #createJobPageOne").replaceWith($("#createJobPageTwo")));
		$("#jobTime").text(getJobTimes);
		$("#jobTitle").focus();
	}
	
	function firstDialog() {
		makeSlider();
		$("#hidingDiv").append($("#createJobPopup > #createJobPageTwo").replaceWith($("#createJobPageOne")));
	}

	function showCreateJob(){
		$("#hidingDiv").append($("#createJobPageOne").detach());
		$("#hidingDiv").append($("#createJobPageTwo").detach());
      	dialog = $("#createJobPopup").dialog({title:"Create Job",
									 modal:true, 
									 draggable:false,
									 width:800, 
									 height:600}).addClass("bodyFont").append($("#createJobPageOne"));
		makeSlider();
  	}
	
	function showManageContacts(){
      	$("#manageContactsPopup").dialog({title:"Manage Contacts",
									 modal:true, 
									 draggable:false, 
									 width:800, 
									 height:600}).addClass("bodyFont");
  	}	
</script>

<body>
<div id="logo">SitterPlan</div>
<table id="buttonRow">
	<tr>
    	<td></td>
    	<td>
			<a href="babysitter_edit_schedule.html"> <input id="editSchedule" type="button" name="editSchedule" value="Edit Schedule" onclick="showEditSchedule();" /> </a>
        </td>
        <td>
            <a href="babysitter_apply_jobs.html"> <input id="applyJobs" type="button" name="applyJobs" value="Apply to Jobs"/> </a>
        </td>
    </tr>
</table>
</table>
<h2>My Jobs</h2>
<table style='border:2px solid #000000; width:100%; text-align:center;' cellPadding="10" >
	<tr>
		<th> Family </td>
		<th> Date </td>
		<th> Time </td>
		<th> Notes </td>
	</tr>
	<tr>
		<td> Frank </td>
		<td> Monday, 4/15/13 </td>
		<td> 7:00pm - 9:00pm </td>
		<td> </td>
	</tr>
	<tr>
		<td> Wu </td>
		<td> Thursday, 4/18/13 </td>
		<td> 6:00pm - 12:00am </td>
		<td> </td>
	</tr>
	<tr>
		<td> Goldstein </td>
		<td> Friday, 4/19/13 </td>
		<td> 7:00pm - 11:00pm </td>
		<td> </td>
	</tr>
</table>
<p style='line-height: 1.3em'> &nbsp; </p>
</table>
<h2>Avalible Jobs</h2>
<table style='border:2px solid #000000; width:100%; text-align:center;' cellPadding="10" >
	<tr>
		<th> Family </td>
		<th> Date </td>
		<th> Time </td>
		<th>  </td>
	</tr>
	<tr>
		<td> Smith </td>
		<td> Monday, 4/15/13 </td>
		<td> 7:00pm - 10:00pm </td>
		<td> <input id="applySmith" type="button" name="applySmith" value="Apply"/></td>
	</tr>
	<tr>
		<td> Anderson </td>
		<td> Wednesday, 4/18/13 </td>
		<td> 8:00pm - 10:00pm </td>
		<td> <input id="applyAnderson" type="button" name="applyAnderson" value="Apply"/></td>
	</tr>
	<tr>
		<td> Evans </td>
		<td> Friday, 4/19/13 </td>
		<td> 6:00pm - 9:00pm </td>
		<td> <input id="applyEvans" type="button" name="applyEvans" value="Apply"/></td>
	</tr>
</table>
</body>
</html>
